<div class="page-header">
  <h1><%= cookbook.name %></h1>
  <p class="lead"><%= metadata["description"] %></p>
</div>
<ul class="nav nav-tabs">
  <li class="active"><a href='#tab-basic' data-toggle='tab'>Basic</a></li>
<% metadata.keys.each do |key| -%>
<%   unless ( metadata[key].empty? or key == 'attributes' or description.include? key ) -%>
  <li><a href='#tab-<%= key %>' data-toggle='tab'><%= key.capitalize %></a></li>
<%   end -%>
<% end -%>
  <li><a href='#tab-files' data-toggle='tab'>Files</a></li>
  <li><a href='#tab-metadata' data-toggle='tab'>Metadata</a></li>
</ul>

<div class='tab-content'>
  <div class='tab-pane active' id='tab-basic'>
    <ul class='list-unstyled'>
<% description.each do |desc| -%>
<%   unless metadata[desc].empty? -%>
  <li><%==  pretty_metadata(desc, metadata[desc]) %></li>
<%   end -%>
<% end -%>
    </ul>
  </div>
<% metadata.each do |key, value| -%>
<%   unless ( metadata[key].empty? or description.include? key ) -%>
<%     if key == "recipes" -%>
  <div class='tab-pane fade in' id='tab-<%= key %>'>
    <ul class="list-unstyled">
<%       cookbook.recipes.sort_by { |k| k["name"].downcase }.each do |recipe| -%>
      <li>
        <a href='<%= url "/cookbook/#{cookbook.name}/recipe/#{recipe.name}" %>'><%= recipe.name %></a>
<%         metadata.recipes.each  do |r, d| -%>
<%           unless r.empty? -%>
<%=            recipe.name.gsub('.rb', '') == r.gsub("#{cookbook.chef_id}::", "") && !d.empty? ? "- #{d}" : "" %>
<%=            recipe.name == "default.rb" && r == cookbook.chef_id && !d.empty? ? "- #{d}" : "" %>
<%           end -%>
<%         end -%>
      </li>
<%       end -%>
    </ul>
  </div>
<%     else -%>
  <div class='tab-pane fade in' id='tab-<%= key %>'>
    <%== pretty_metadata(key, value) %>
  </div>
<%     end -%>
<%   end -%>
<% end -%>
  <div class='tab-pane fade in' id='tab-files'>
<% file_types.each do |file_type| -%>
<%   unless cookbook.send(file_type).empty? -%>
<%     unless file_type.capitalize == 'Root_files' %>
    <h2><%= file_type.capitalize %></h2>
  <%     end %>
    <ul class='list-unstyled'>
<%     cookbook.send(file_type).sort_by { |k| k["name"].downcase }.each do |file| -%>
      <li><a href='<%= url "/cookbook/#{cookbook.name}/#{file_type}/#{file.name}" %>'><%= file.name %></a></li>
<%     end -%>
    </ul>
<%   end -%>
<% end -%>
  </div>
  <div class='tab-pane fade in' id='tab-metadata'>
    <%== CodeRay.scan(JSON.pretty_generate(metadata), :json).div(:line_numbers => nil) %>
  </div>
</div>
